# Road Traffic Collision Analytics Dashboard

This project is a Phoenix LiveView application for analyzing road traffic collision data from Northern Ireland. It provides real-time statistics, visualizations, and a data grid for exploring collision records.

---

## Setup Instructions

### Dependencies

Ensure the following dependencies are installed:
- **Elixir**: `~> 1.18`
- **Erlang/OTP**: Compatible with Elixir 1.18
- **PostgreSQL**: `>= 14`
- **Node.js**: `>= 23.9`

You can use provided `.tool-versions` config file for `asdf`

### Database Setup

1. Create a PostgreSQL database:
   ```bash
   psql -U postgres -c "CREATE DATABASE ag_collisions_dev;"
   ```
   or run

   ```bash
   mix ecto.create
   ```
   but the second command will work if `config/dev.exs` has proper credentials to postgres (see 2)

2. Configure the database in `config/dev.exs`:
   ```elixir
   config :ag_collisions, AgCollisions.Repo,
     username: "postgres",
     password: "postgres",
     database: "ag_collisions_dev",
     hostname: "localhost",
     show_sensitive_data_on_connection_error: true,
     pool_size: 10
   ```

3. Run database migrations/seed:
   ```bash
   mix ecto.setup
   ```

### Import Collision Data

1. Check if CSV files (`collision2017-2022.csv`,`vehicle2017-2022.csv`,`vehicle-index.csv`) are present in the `priv/repo/seeds/` directory.
2. Run the data import task:
   ```bash
   mix run priv/repo/seeds.exs
   ```
   Please have in mind that this is not needed if `mix ecto.setup` command was performed

### Running the Application

1. Start the Phoenix server:
   ```bash
   mix phx.server
   ```
2. Open your browser and navigate to [http://localhost:4000](http://localhost:4000).

### Running Tests

1. Create and migrate the test database:
   ```bash
   MIX_ENV=test mix ecto.setup
   ```
2. Run the test suite:
   ```bash
   mix test
   ```

---

## Database Schema Design

### Schema Overview

The `collisions` table includes the following fields:
- `uuid`: Unique identifier for the collision.
- `date`: Date and time of the collision.
- `district`: District where the collision occurred.
- `severity`: Severity of the collision (`:fatal`, `:serious`, `:slight`).
- `casualties`: Number of casualties in the collision.
- `weather`: Weather conditions during the collision.
- `road_condition`: Road surface conditions during the collision.
- `light_condition`: Light conditions during the collision.
- `speed_limit`: Speed limit at the collision location.

+-------------------+       +-------------------+       +-------------------+
|   collisions      |       |collisions_vehicles|       |   vehicle_type    |
+-------------------+       +-------------------+       +-------------------+
| uuid (PK)         |------<| id (PK)           |>------| id (PK)           |
| date              |       | collision_uuid(FK)|       | type              |
| district          |       | type_id (FK)      |       | timestamps        |
| severity          |       |                   |       +-------------------+
| casualties        |       +-------------------+
| weather           |    
| road_condition    |    
| light_condition   |    
| speed_limit    
| timestamps        |    
+-------------------+    
                         

### Assumptions

1. **Severity Enum**: The `severity` field is stored as an Ecto enum for efficient querying and validation.
2. **Data Completeness**: 
  - Assumes the provided dataset is complete and accurate. 
  - One record in `vehicle2017-2022.csv` was missing a `v_type` so assumption was it should be 0
3. **Primary Key**: 
  - PK in CSV were a composite from `a_ref`, `a_year`
  - in DB it is a one UUID that can be generated by this code
    ```elixir
    UUID.uuid5(:url, "#{a_year}-#{a_ref}")
    ```

---

## Improvements with More Time

1. **Enhanced Filtering**:
   - Add support for filtering by weather, road conditions, and light conditions.
   - Allow multi-select for districts.

2. **Performance Optimization**:
   - Select only nneeded modules from ag-grid/ag-chart

3. **UI Enhancements**:
   - Improve styling
   - Improve mobile responsiveness.

4. **Error Handling**:
   - Add user-friendly error messages for data import and server issues.

5. **Testing**:
   - Increase test coverage for LiveView.
   - Add integration tests for LiveView components.

